{"uid":"35c571193fcf2140","name":"Проверка запуска одной и той же билд конфигурации несколько раз","fullName":"tests.backend.test_run_build_conf.TestRunBuildConfSeveralTimes#test_run_build_conf_several_times_with_roles","historyId":"f48e2163acbcc1c30fac0c035d74a121","time":{"start":1711918463694,"stop":1711918509337,"duration":45643},"description":"Тест проверяет запуск одной и той билд конфигурации несколько раз.","descriptionHtml":"<p>Тест проверяет запуск одной и той билд конфигурации несколько раз.</p>\n","status":"failed","statusMessage":"pytest_assume.plugin.FailedAssumption: \n1 Failed Assumptions:\n\ntests/backend/test_run_build_conf.py:75: AssumptionFailure\n>>\twith pytest.assume:\nAssertionError: build was expected to be out of the query=0, but it is still here: query=1\nassert 1 == 0\n +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 2, 'buildTypeId': 'DE3vTR1jkme', 'state': 'queued', 'href': '/app/rest/buildQueue/id:2', 'webUrl': 'http://localhost:8111/build/2'}]).count","statusTrace":"self = <test_run_build_conf.TestRunBuildConfSeveralTimes object at 0x7ff9796bf520>\nsuper_admin = <entities.user.User object at 0x7ff9796c35e0>\nuser_create = <function user_create.<locals>._user_create at 0x7ff9795eb640>\nproject_data = ProjectDataModel(parentProject={'locator': '_Root'}, name='sSabQ9AzsHM', id='BWCtGvlbPWO', copeAllAssociatedSettings=True)\nbuild_conf_data = BuildDataModel(id='DE3vTR1jkme', name='tV6lIBuomrq', project={'id': 'BWCtGvlbPWO'}, steps={'step': [{'name': 'myComman...llo World!'\"}, {'name': 'teamcity.step.mode', 'value': 'default'}, {'name': 'use.custom.script', 'value': 'true'}]}}]})\nbuild_conf_run_data = BuildRunRequestModel(buildType=BuildTypesModel(id='DE3vTR1jkme'))\n\n    @allure.feature('Управление запуском билд конфигураций')\n    @allure.story('Отправка запроса на запуск одной и той же билд конфигурации несколько раз с разными ролями')\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.link('https://example.com/docs/create_project', name='Документация')\n    @allure.issue('https://issue.tracker/project/123', name='Баг-трекер')\n    @allure.testcase('https://testcase.manager/testcase/456', name='Тест-кейс-23')\n    @allure.title('Проверка запуска одной и той же билд конфигурации несколько раз')\n    @allure.description('Тест проверяет запуск одной и той билд конфигурации несколько раз.')\n    \n    def test_run_build_conf_several_times_with_roles(self, super_admin, user_create, project_data, build_conf_data, build_conf_run_data):\n    \n        with allure.step('Отправка запроса на создание проекта'):\n            project_data_1 = project_data\n            create_project_response = super_admin.api_manager.project_api.create_project(project_data_1.model_dump()).text\n        with allure.step(\"Проверка соответствия параметров созданного проекта с отправленными данными\"):\n            project_model_response = ProjectResponseModel.model_validate_json(create_project_response)\n        with pytest.assume:\n            assert project_model_response.id == project_data_1.id, \\\n                f\"expected project id= {project_data_1.id}, but '{project_model_response.id}' given\"\n        with pytest.assume:\n            assert project_model_response.parentProjectId == project_data_1.parentProject[\"locator\"], \\\n                (f\"expected parent project id= {project_data_1.parentProject['locator']},\"\n                 f\" but '{project_model_response.parentProjectId}' given in response\")\n        with allure.step(\"Отправка запроса на создание билд конфигурации\"):\n            build_conf_data_1 = build_conf_data\n            build_config_response = super_admin.api_manager.build_conf_api.create_build_conf(build_conf_data_1.model_dump()).text\n        with allure.step(\"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"):\n            build_conf_model_response = BuildResponseModel.model_validate_json(build_config_response)\n        with pytest.assume:\n            assert build_conf_model_response.id == build_conf_data_1.id, \\\n                f\"expected build conf id= {build_conf_data_1.id}, but '{build_conf_model_response.id}' given\"\n        with allure.step('Отправка запроса на запуск билд конфигурации'):\n            build_conf_run_data_1 = build_conf_run_data\n            build_run_response = super_admin.api_manager.run_build_conf_api.run_build_conf(build_conf_run_data_1.model_dump()).text\n            time.sleep(20)\n        with allure.step(\"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными\"):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(build_run_response)\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", \\\n                f\"build was expected to be run= {build_run_model_response.state} should be queued, but it is not in a query= {build_run_model_response.state}\"\n        with allure.step(\"Проверка количества билд конфигураций в очереди для запуска\"):\n            get_build_conf_run_response = super_admin.api_manager.run_build_conf_api.check_query_with_build_conf().text\n        with allure.step(\"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными\"):\n            build_conf_run_check_model_response = BuildConfRunStatusModel.model_validate_json(get_build_conf_run_response)\n        with pytest.assume:\n            assert build_conf_run_check_model_response.count == 0, \\\n                f\"build was expected to be out of the query=0, but it is still here: query={build_conf_run_check_model_response.count}\"\n        with allure.step(\"Отправка запроса на повторный запуск билд конфигурации\"):\n            build_conf_run_data_2 = copy.deepcopy(build_conf_run_data)\n            build_run_response = super_admin.api_manager.run_build_conf_api.run_build_conf(build_conf_run_data_2.model_dump()).text\n            time.sleep(20)\n        with allure.step(\"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными\"):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(build_run_response)\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", \\\n                    f\"build was expected to be run= {build_run_model_response.state} should be queued, but it is not in a query= {build_run_model_response.state}\"\n        with allure.step(\"Отправка запроса на проверку количества билд конфигураций в очереди для запуска\"):\n            get_build_conf_run_response = super_admin.api_manager.run_build_conf_api.check_query_with_build_conf().text\n            time.sleep(5)\n        with allure.step(\"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными\"):\n                build_conf_run_check_model_response = BuildConfRunStatusModel.model_validate_json(get_build_conf_run_response)\n        with pytest.assume:\n>           assert build_conf_run_check_model_response.count == 0, \\\n                    f\"build was expected to be out of the query=0, but it is still here: query={build_conf_run_check_model_response.count}\"\nE           pytest_assume.plugin.FailedAssumption: \nE           1 Failed Assumptions:\nE           \nE           tests/backend/test_run_build_conf.py:75: AssumptionFailure\nE           >>\twith pytest.assume:\nE           AssertionError: build was expected to be out of the query=0, but it is still here: query=1\nE           assert 1 == 0\nE            +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 2, 'buildTypeId': 'DE3vTR1jkme', 'state': 'queued', 'href': '/app/rest/buildQueue/id:2', 'webUrl': 'http://localhost:8111/build/2'}]).count\n\ntests/backend/test_run_build_conf.py:76: FailedAssumption","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"user_session","time":{"start":1711918463688,"stop":1711918463688,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"super_admin","time":{"start":1711918463689,"stop":1711918463693,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_create","time":{"start":1711918463693,"stop":1711918463693,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_data","time":{"start":1711918463693,"stop":1711918463693,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"project_data","time":{"start":1711918463693,"stop":1711918463693,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_run_data","time":{"start":1711918463693,"stop":1711918463693,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"description":"Тест проверяет запуск одной и той билд конфигурации несколько раз.","status":"failed","statusMessage":"pytest_assume.plugin.FailedAssumption: \n1 Failed Assumptions:\n\ntests/backend/test_run_build_conf.py:75: AssumptionFailure\n>>\twith pytest.assume:\nAssertionError: build was expected to be out of the query=0, but it is still here: query=1\nassert 1 == 0\n +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 2, 'buildTypeId': 'DE3vTR1jkme', 'state': 'queued', 'href': '/app/rest/buildQueue/id:2', 'webUrl': 'http://localhost:8111/build/2'}]).count","statusTrace":"self = <test_run_build_conf.TestRunBuildConfSeveralTimes object at 0x7ff9796bf520>\nsuper_admin = <entities.user.User object at 0x7ff9796c35e0>\nuser_create = <function user_create.<locals>._user_create at 0x7ff9795eb640>\nproject_data = ProjectDataModel(parentProject={'locator': '_Root'}, name='sSabQ9AzsHM', id='BWCtGvlbPWO', copeAllAssociatedSettings=True)\nbuild_conf_data = BuildDataModel(id='DE3vTR1jkme', name='tV6lIBuomrq', project={'id': 'BWCtGvlbPWO'}, steps={'step': [{'name': 'myComman...llo World!'\"}, {'name': 'teamcity.step.mode', 'value': 'default'}, {'name': 'use.custom.script', 'value': 'true'}]}}]})\nbuild_conf_run_data = BuildRunRequestModel(buildType=BuildTypesModel(id='DE3vTR1jkme'))\n\n    @allure.feature('Управление запуском билд конфигураций')\n    @allure.story('Отправка запроса на запуск одной и той же билд конфигурации несколько раз с разными ролями')\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.link('https://example.com/docs/create_project', name='Документация')\n    @allure.issue('https://issue.tracker/project/123', name='Баг-трекер')\n    @allure.testcase('https://testcase.manager/testcase/456', name='Тест-кейс-23')\n    @allure.title('Проверка запуска одной и той же билд конфигурации несколько раз')\n    @allure.description('Тест проверяет запуск одной и той билд конфигурации несколько раз.')\n    \n    def test_run_build_conf_several_times_with_roles(self, super_admin, user_create, project_data, build_conf_data, build_conf_run_data):\n    \n        with allure.step('Отправка запроса на создание проекта'):\n            project_data_1 = project_data\n            create_project_response = super_admin.api_manager.project_api.create_project(project_data_1.model_dump()).text\n        with allure.step(\"Проверка соответствия параметров созданного проекта с отправленными данными\"):\n            project_model_response = ProjectResponseModel.model_validate_json(create_project_response)\n        with pytest.assume:\n            assert project_model_response.id == project_data_1.id, \\\n                f\"expected project id= {project_data_1.id}, but '{project_model_response.id}' given\"\n        with pytest.assume:\n            assert project_model_response.parentProjectId == project_data_1.parentProject[\"locator\"], \\\n                (f\"expected parent project id= {project_data_1.parentProject['locator']},\"\n                 f\" but '{project_model_response.parentProjectId}' given in response\")\n        with allure.step(\"Отправка запроса на создание билд конфигурации\"):\n            build_conf_data_1 = build_conf_data\n            build_config_response = super_admin.api_manager.build_conf_api.create_build_conf(build_conf_data_1.model_dump()).text\n        with allure.step(\"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"):\n            build_conf_model_response = BuildResponseModel.model_validate_json(build_config_response)\n        with pytest.assume:\n            assert build_conf_model_response.id == build_conf_data_1.id, \\\n                f\"expected build conf id= {build_conf_data_1.id}, but '{build_conf_model_response.id}' given\"\n        with allure.step('Отправка запроса на запуск билд конфигурации'):\n            build_conf_run_data_1 = build_conf_run_data\n            build_run_response = super_admin.api_manager.run_build_conf_api.run_build_conf(build_conf_run_data_1.model_dump()).text\n            time.sleep(20)\n        with allure.step(\"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными\"):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(build_run_response)\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", \\\n                f\"build was expected to be run= {build_run_model_response.state} should be queued, but it is not in a query= {build_run_model_response.state}\"\n        with allure.step(\"Проверка количества билд конфигураций в очереди для запуска\"):\n            get_build_conf_run_response = super_admin.api_manager.run_build_conf_api.check_query_with_build_conf().text\n        with allure.step(\"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными\"):\n            build_conf_run_check_model_response = BuildConfRunStatusModel.model_validate_json(get_build_conf_run_response)\n        with pytest.assume:\n            assert build_conf_run_check_model_response.count == 0, \\\n                f\"build was expected to be out of the query=0, but it is still here: query={build_conf_run_check_model_response.count}\"\n        with allure.step(\"Отправка запроса на повторный запуск билд конфигурации\"):\n            build_conf_run_data_2 = copy.deepcopy(build_conf_run_data)\n            build_run_response = super_admin.api_manager.run_build_conf_api.run_build_conf(build_conf_run_data_2.model_dump()).text\n            time.sleep(20)\n        with allure.step(\"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными\"):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(build_run_response)\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", \\\n                    f\"build was expected to be run= {build_run_model_response.state} should be queued, but it is not in a query= {build_run_model_response.state}\"\n        with allure.step(\"Отправка запроса на проверку количества билд конфигураций в очереди для запуска\"):\n            get_build_conf_run_response = super_admin.api_manager.run_build_conf_api.check_query_with_build_conf().text\n            time.sleep(5)\n        with allure.step(\"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными\"):\n                build_conf_run_check_model_response = BuildConfRunStatusModel.model_validate_json(get_build_conf_run_response)\n        with pytest.assume:\n>           assert build_conf_run_check_model_response.count == 0, \\\n                    f\"build was expected to be out of the query=0, but it is still here: query={build_conf_run_check_model_response.count}\"\nE           pytest_assume.plugin.FailedAssumption: \nE           1 Failed Assumptions:\nE           \nE           tests/backend/test_run_build_conf.py:75: AssumptionFailure\nE           >>\twith pytest.assume:\nE           AssertionError: build was expected to be out of the query=0, but it is still here: query=1\nE           assert 1 == 0\nE            +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 2, 'buildTypeId': 'DE3vTR1jkme', 'state': 'queued', 'href': '/app/rest/buildQueue/id:2', 'webUrl': 'http://localhost:8111/build/2'}]).count\n\ntests/backend/test_run_build_conf.py:76: FailedAssumption","steps":[{"name":"Отправка запроса на создание проекта","time":{"start":1711918463694,"stop":1711918463710,"duration":16},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданного проекта с отправленными данными","time":{"start":1711918463710,"stop":1711918463710,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на создание билд конфигурации","time":{"start":1711918463712,"stop":1711918463730,"duration":18},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданной билд конфигурации с отправленными данными","time":{"start":1711918463730,"stop":1711918463730,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на запуск билд конфигурации","time":{"start":1711918463732,"stop":1711918484284,"duration":20552},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными","time":{"start":1711918484284,"stop":1711918484284,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка количества билд конфигураций в очереди для запуска","time":{"start":1711918484285,"stop":1711918484291,"duration":6},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными","time":{"start":1711918484291,"stop":1711918484291,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на повторный запуск билд конфигурации","time":{"start":1711918484292,"stop":1711918504324,"duration":20032},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными","time":{"start":1711918504324,"stop":1711918504324,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на проверку количества билд конфигураций в очереди для запуска","time":{"start":1711918504325,"stop":1711918509334,"duration":5009},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными","time":{"start":1711918509334,"stop":1711918509334,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"attachments":[{"uid":"1724961d00ab5df9","name":"log","source":"1724961d00ab5df9.txt","type":"text/plain","size":7404}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":12,"attachmentsCount":1,"hasContent":true},"afterStages":[{"name":"build_conf_data::0","time":{"start":1711918509347,"stop":1711918509361,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_run_data::0","time":{"start":1711918509347,"stop":1711918509347,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"project_data::0","time":{"start":1711918509362,"stop":1711918509387,"duration":25},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_create::0","time":{"start":1711918509388,"stop":1711918509388,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_session::0","time":{"start":1711918509388,"stop":1711918509389,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"labels":[{"name":"severity","value":"critical"},{"name":"story","value":"Отправка запроса на запуск одной и той же билд конфигурации несколько раз с разными ролями"},{"name":"feature","value":"Управление запуском билд конфигураций"},{"name":"parentSuite","value":"tests.backend"},{"name":"suite","value":"test_run_build_conf"},{"name":"subSuite","value":"TestRunBuildConfSeveralTimes"},{"name":"host","value":"fv-az1022-878"},{"name":"thread","value":"7981-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.backend.test_run_build_conf"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"build_conf_data","value":"'tV6lIBuomrq'"},{"name":"project_data","value":"'sSabQ9AzsHM'"},{"name":"user_create","value":"<Roles.PROJECT_ADMIN: 'PROJECT_ADMIN'>"}],"links":[{"name":"Тест-кейс-23","url":"https://testcase.manager/testcase/456","type":"tms"},{"name":"Баг-трекер","url":"https://issue.tracker/project/123","type":"issue"},{"name":"Документация","url":"https://example.com/docs/create_project","type":"link"}],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"35c571193fcf2140.json","parameterValues":["'tV6lIBuomrq'","'sSabQ9AzsHM'","<Roles.PROJECT_ADMIN: 'PROJECT_ADMIN'>"]}