{"uid":"a2ef361a1f01d041","name":"Проверка запуска одной и той же билд конфигурации несколько раз","fullName":"tests.backend.test_run_build_conf.TestRunBuildConfSeveralTimes#test_run_build_conf_several_times_with_roles","historyId":"2fca27110ea0d7564e92f99b92926c62","time":{"start":1712156847936,"stop":1712156893101,"duration":45165},"description":"Тест проверяет запуск одной и той билд конфигурации несколько раз.","descriptionHtml":"<p>Тест проверяет запуск одной и той билд конфигурации несколько раз.</p>\n","status":"failed","statusMessage":"pytest_assume.plugin.FailedAssumption: \n1 Failed Assumptions:\n\ntests/backend/test_run_build_conf.py:110: AssumptionFailure\n>>\twith pytest.assume:\nAssertionError: build was expected to be out of the query=0, but it is still here: query=1\nassert 1 == 0\n +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 3, 'buildTypeId': 'aFiBGPPANEd', 'state': 'queued', 'href': '/app/rest/buildQueue/id:3', 'webUrl': 'http://localhost:8111/build/3'}]).count","statusTrace":"self = <test_run_build_conf.TestRunBuildConfSeveralTimes object at 0x7fd840eaaf50>\nsuper_admin = <entities.user.User object at 0x7fd840e110f0>\nuser_create = <function user_create.<locals>._user_create at 0x7fd840c54310>\nproject_data = ProjectDataModel(parentProject={'locator': '_Root'}, name='nUvexM7yOJd', id='gxSoWDWz7rE', copeAllAssociatedSettings=True)\nbuild_conf_data = BuildDataModel(id='aFiBGPPANEd', name='oAZbQO6jvLe', project={'id': 'gxSoWDWz7rE'}, steps={'step': [{'name': 'myComman...llo World!'\"}, {'name': 'teamcity.step.mode', 'value': 'default'}, {'name': 'use.custom.script', 'value': 'true'}]}}]})\nbuild_conf_run_data = BuildRunRequestModel(buildType=BuildTypesModel(id='aFiBGPPANEd'))\n\n    @allure.feature(\"Управление запуском билд конфигураций\")\n    @allure.story(\n        \"Отправка запроса на запуск одной и той же билд конфигурации несколько раз с разными ролями\"\n    )\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.link(\"https://example.com/docs/create_project\", name=\"Документация\")\n    @allure.issue(\"https://issue.tracker/project/123\", name=\"Баг-трекер\")\n    @allure.testcase(\"https://testcase.manager/testcase/456\", name=\"Тест-кейс-23\")\n    @allure.title(\"Проверка запуска одной и той же билд конфигурации несколько раз\")\n    @allure.description(\n        \"Тест проверяет запуск одной и той билд конфигурации несколько раз.\"\n    )\n    def test_run_build_conf_several_times_with_roles(\n        self,\n        super_admin,\n        user_create,\n        project_data,\n        build_conf_data,\n        build_conf_run_data,\n    ):\n    \n        with allure.step(\"Отправка запроса на создание проекта\"):\n            project_data_1 = project_data\n            create_project_response = (\n                super_admin.api_manager.project_api.create_project(\n                    project_data_1.model_dump()\n                ).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданного проекта с отправленными данными\"\n        ):\n            project_model_response = ProjectResponseModel.model_validate_json(\n                create_project_response\n            )\n        with pytest.assume:\n            assert (\n                project_model_response.id == project_data_1.id\n            ), f\"expected project id= {project_data_1.id}, but '{project_model_response.id}' given\"\n        with pytest.assume:\n            assert (\n                project_model_response.parentProjectId\n                == project_data_1.parentProject[\"locator\"]\n            ), (\n                f\"expected parent project id= {project_data_1.parentProject['locator']},\"\n                f\" but '{project_model_response.parentProjectId}' given in response\"\n            )\n        with allure.step(\"Отправка запроса на создание билд конфигурации\"):\n            build_conf_data_1 = build_conf_data\n            build_config_response = (\n                super_admin.api_manager.build_conf_api.create_build_conf(\n                    build_conf_data_1.model_dump()\n                ).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"\n        ):\n            build_conf_model_response = BuildResponseModel.model_validate_json(\n                build_config_response\n            )\n        with pytest.assume:\n            assert build_conf_model_response.id == build_conf_data_1.id, (\n                f\"expected build conf id= {build_conf_data_1.id},\"\n                f\" but '{build_conf_model_response.id}' given\"\n            )\n        with allure.step(\"Отправка запроса на запуск билд конфигурации\"):\n            build_conf_run_data_1 = build_conf_run_data\n            build_run_response = (\n                super_admin.api_manager.run_build_conf_api.run_build_conf(\n                    build_conf_run_data_1.model_dump()\n                ).text\n            )\n            time.sleep(20)\n        with allure.step(\n            \"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными\"\n        ):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(\n                build_run_response\n            )\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", (\n                f\"build was expected to be run= {build_run_model_response.state} should be queued,\"\n                f\" but it is not in a query= {build_run_model_response.state}\"\n            )\n        with allure.step(\"Проверка количества билд конфигураций в очереди для запуска\"):\n            get_build_conf_run_response = (\n                super_admin.api_manager.run_build_conf_api.check_query_with_build_conf().text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными\"\n        ):\n            build_conf_run_check_model_response = (\n                BuildConfRunStatusModel.model_validate_json(get_build_conf_run_response)\n            )\n        with pytest.assume:\n>           assert build_conf_run_check_model_response.count == 0, (\n                f\"build was expected to be out of the query=0,\"\n                f\" but it is still here:\"\n                f\" query={build_conf_run_check_model_response.count}\"\n            )\nE           pytest_assume.plugin.FailedAssumption: \nE           1 Failed Assumptions:\nE           \nE           tests/backend/test_run_build_conf.py:110: AssumptionFailure\nE           >>\twith pytest.assume:\nE           AssertionError: build was expected to be out of the query=0, but it is still here: query=1\nE           assert 1 == 0\nE            +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 3, 'buildTypeId': 'aFiBGPPANEd', 'state': 'queued', 'href': '/app/rest/buildQueue/id:3', 'webUrl': 'http://localhost:8111/build/3'}]).count\n\ntests/backend/test_run_build_conf.py:111: FailedAssumption","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1712156795370,"stop":1712156795385,"duration":15},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_session","time":{"start":1712156847929,"stop":1712156847929,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"super_admin","time":{"start":1712156847930,"stop":1712156847935,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_create","time":{"start":1712156847935,"stop":1712156847935,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"project_data","time":{"start":1712156847935,"stop":1712156847935,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_data","time":{"start":1712156847935,"stop":1712156847935,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_run_data","time":{"start":1712156847936,"stop":1712156847936,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"description":"Тест проверяет запуск одной и той билд конфигурации несколько раз.","status":"failed","statusMessage":"pytest_assume.plugin.FailedAssumption: \n1 Failed Assumptions:\n\ntests/backend/test_run_build_conf.py:110: AssumptionFailure\n>>\twith pytest.assume:\nAssertionError: build was expected to be out of the query=0, but it is still here: query=1\nassert 1 == 0\n +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 3, 'buildTypeId': 'aFiBGPPANEd', 'state': 'queued', 'href': '/app/rest/buildQueue/id:3', 'webUrl': 'http://localhost:8111/build/3'}]).count","statusTrace":"self = <test_run_build_conf.TestRunBuildConfSeveralTimes object at 0x7fd840eaaf50>\nsuper_admin = <entities.user.User object at 0x7fd840e110f0>\nuser_create = <function user_create.<locals>._user_create at 0x7fd840c54310>\nproject_data = ProjectDataModel(parentProject={'locator': '_Root'}, name='nUvexM7yOJd', id='gxSoWDWz7rE', copeAllAssociatedSettings=True)\nbuild_conf_data = BuildDataModel(id='aFiBGPPANEd', name='oAZbQO6jvLe', project={'id': 'gxSoWDWz7rE'}, steps={'step': [{'name': 'myComman...llo World!'\"}, {'name': 'teamcity.step.mode', 'value': 'default'}, {'name': 'use.custom.script', 'value': 'true'}]}}]})\nbuild_conf_run_data = BuildRunRequestModel(buildType=BuildTypesModel(id='aFiBGPPANEd'))\n\n    @allure.feature(\"Управление запуском билд конфигураций\")\n    @allure.story(\n        \"Отправка запроса на запуск одной и той же билд конфигурации несколько раз с разными ролями\"\n    )\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.link(\"https://example.com/docs/create_project\", name=\"Документация\")\n    @allure.issue(\"https://issue.tracker/project/123\", name=\"Баг-трекер\")\n    @allure.testcase(\"https://testcase.manager/testcase/456\", name=\"Тест-кейс-23\")\n    @allure.title(\"Проверка запуска одной и той же билд конфигурации несколько раз\")\n    @allure.description(\n        \"Тест проверяет запуск одной и той билд конфигурации несколько раз.\"\n    )\n    def test_run_build_conf_several_times_with_roles(\n        self,\n        super_admin,\n        user_create,\n        project_data,\n        build_conf_data,\n        build_conf_run_data,\n    ):\n    \n        with allure.step(\"Отправка запроса на создание проекта\"):\n            project_data_1 = project_data\n            create_project_response = (\n                super_admin.api_manager.project_api.create_project(\n                    project_data_1.model_dump()\n                ).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданного проекта с отправленными данными\"\n        ):\n            project_model_response = ProjectResponseModel.model_validate_json(\n                create_project_response\n            )\n        with pytest.assume:\n            assert (\n                project_model_response.id == project_data_1.id\n            ), f\"expected project id= {project_data_1.id}, but '{project_model_response.id}' given\"\n        with pytest.assume:\n            assert (\n                project_model_response.parentProjectId\n                == project_data_1.parentProject[\"locator\"]\n            ), (\n                f\"expected parent project id= {project_data_1.parentProject['locator']},\"\n                f\" but '{project_model_response.parentProjectId}' given in response\"\n            )\n        with allure.step(\"Отправка запроса на создание билд конфигурации\"):\n            build_conf_data_1 = build_conf_data\n            build_config_response = (\n                super_admin.api_manager.build_conf_api.create_build_conf(\n                    build_conf_data_1.model_dump()\n                ).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"\n        ):\n            build_conf_model_response = BuildResponseModel.model_validate_json(\n                build_config_response\n            )\n        with pytest.assume:\n            assert build_conf_model_response.id == build_conf_data_1.id, (\n                f\"expected build conf id= {build_conf_data_1.id},\"\n                f\" but '{build_conf_model_response.id}' given\"\n            )\n        with allure.step(\"Отправка запроса на запуск билд конфигурации\"):\n            build_conf_run_data_1 = build_conf_run_data\n            build_run_response = (\n                super_admin.api_manager.run_build_conf_api.run_build_conf(\n                    build_conf_run_data_1.model_dump()\n                ).text\n            )\n            time.sleep(20)\n        with allure.step(\n            \"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными\"\n        ):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(\n                build_run_response\n            )\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", (\n                f\"build was expected to be run= {build_run_model_response.state} should be queued,\"\n                f\" but it is not in a query= {build_run_model_response.state}\"\n            )\n        with allure.step(\"Проверка количества билд конфигураций в очереди для запуска\"):\n            get_build_conf_run_response = (\n                super_admin.api_manager.run_build_conf_api.check_query_with_build_conf().text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными\"\n        ):\n            build_conf_run_check_model_response = (\n                BuildConfRunStatusModel.model_validate_json(get_build_conf_run_response)\n            )\n        with pytest.assume:\n>           assert build_conf_run_check_model_response.count == 0, (\n                f\"build was expected to be out of the query=0,\"\n                f\" but it is still here:\"\n                f\" query={build_conf_run_check_model_response.count}\"\n            )\nE           pytest_assume.plugin.FailedAssumption: \nE           1 Failed Assumptions:\nE           \nE           tests/backend/test_run_build_conf.py:110: AssumptionFailure\nE           >>\twith pytest.assume:\nE           AssertionError: build was expected to be out of the query=0, but it is still here: query=1\nE           assert 1 == 0\nE            +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 3, 'buildTypeId': 'aFiBGPPANEd', 'state': 'queued', 'href': '/app/rest/buildQueue/id:3', 'webUrl': 'http://localhost:8111/build/3'}]).count\n\ntests/backend/test_run_build_conf.py:111: FailedAssumption","steps":[{"name":"Отправка запроса на создание проекта","time":{"start":1712156847936,"stop":1712156847954,"duration":18},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданного проекта с отправленными данными","time":{"start":1712156847954,"stop":1712156847954,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на создание билд конфигурации","time":{"start":1712156847956,"stop":1712156847976,"duration":20},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданной билд конфигурации с отправленными данными","time":{"start":1712156847976,"stop":1712156847976,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на запуск билд конфигурации","time":{"start":1712156847978,"stop":1712156868025,"duration":20047},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными","time":{"start":1712156868025,"stop":1712156868025,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка количества билд конфигураций в очереди для запуска","time":{"start":1712156868026,"stop":1712156868031,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными","time":{"start":1712156868031,"stop":1712156868031,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на повторный запуск билд конфигурации","time":{"start":1712156868033,"stop":1712156888089,"duration":20056},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенной билд конфигурации с отправленными данными","time":{"start":1712156888089,"stop":1712156888089,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на проверку количества билд конфигураций в очереди для запуска","time":{"start":1712156888090,"stop":1712156893100,"duration":5010},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров запущенных билд конфигураций с отправленными данными","time":{"start":1712156893100,"stop":1712156893100,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"attachments":[{"uid":"ce79adc069383a1b","name":"log","source":"ce79adc069383a1b.txt","type":"text/plain","size":7448}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":12,"attachmentsCount":1,"hasContent":true},"afterStages":[{"name":"build_conf_data::0","time":{"start":1712156893107,"stop":1712156893122,"duration":15},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_run_data::0","time":{"start":1712156893107,"stop":1712156893107,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"project_data::0","time":{"start":1712156893122,"stop":1712156893136,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_create::0","time":{"start":1712156893138,"stop":1712156893138,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_session::0","time":{"start":1712156893138,"stop":1712156893138,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"labels":[{"name":"severity","value":"critical"},{"name":"feature","value":"Управление запуском билд конфигураций"},{"name":"story","value":"Отправка запроса на запуск одной и той же билд конфигурации несколько раз с разными ролями"},{"name":"parentSuite","value":"tests.backend"},{"name":"suite","value":"test_run_build_conf"},{"name":"subSuite","value":"TestRunBuildConfSeveralTimes"},{"name":"host","value":"fv-az842-403"},{"name":"thread","value":"7780-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.backend.test_run_build_conf"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"build_conf_data","value":"'oAZbQO6jvLe'"},{"name":"project_data","value":"'nUvexM7yOJd'"},{"name":"user_create","value":"<Roles.PROJECT_DEVELOPER: 'PROJECT_DEVELOPER'>"}],"links":[{"name":"Тест-кейс-23","url":"https://testcase.manager/testcase/456","type":"tms"},{"name":"Баг-трекер","url":"https://issue.tracker/project/123","type":"issue"},{"name":"Документация","url":"https://example.com/docs/create_project","type":"link"}],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"a2ef361a1f01d041.json","parameterValues":["'oAZbQO6jvLe'","'nUvexM7yOJd'","<Roles.PROJECT_DEVELOPER: 'PROJECT_DEVELOPER'>"]}