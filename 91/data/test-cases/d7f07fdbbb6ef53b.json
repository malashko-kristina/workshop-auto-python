{"uid":"d7f07fdbbb6ef53b","name":"Проверка юзер флоу по созданию проекта, билд конфигурации и ее запуску","fullName":"tests.backend.test_user_critical_flow.TestProjectCreate#test_user_critical_flow_with_roles","historyId":"7b996077c62479df47fdc6df45712d72","time":{"start":1712229880966,"stop":1712229916059,"duration":35093},"description":"Тест проверяет создание нового проекта и его появление в общем списке проектов.","descriptionHtml":"<p>Тест проверяет создание нового проекта и его появление в общем списке проектов.</p>\n","status":"failed","statusMessage":"pytest_assume.plugin.FailedAssumption: \n1 Failed Assumptions:\n\ntests/backend/test_user_critical_flow.py:140: AssumptionFailure\n>>\twith pytest.assume:\nAssertionError: build was expected to be out of the query=0, but it is still here: query=1\nassert 1 == 0\n +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 7, 'buildTypeId': 'J3hLqYKy8PG', 'state': 'queued', 'href': '/app/rest/buildQueue/id:7', 'webUrl': 'http://localhost:8111/build/7'}]).count","statusTrace":"self = <test_user_critical_flow.TestProjectCreate object at 0x7fa9a9a5f3a0>\nsuper_admin = <entities.user.User object at 0x7fa9a97e4be0>\nuser_create = <function user_create.<locals>._user_create at 0x7fa9a9738310>\nproject_data = ProjectDataModel(parentProject={'locator': '_Root'}, name='StAS78dH3D7', id='zpfj3Qzy47Q', copeAllAssociatedSettings=True)\nbuild_conf_data = BuildDataModel(id='J3hLqYKy8PG', name='wDXqbSHCcgI', project={'id': 'zpfj3Qzy47Q'}, steps={'step': [{'name': 'myComman...llo World!'\"}, {'name': 'teamcity.step.mode', 'value': 'default'}, {'name': 'use.custom.script', 'value': 'true'}]}}]})\nbuild_conf_run_data = BuildRunRequestModel(buildType=BuildTypesModel(id='J3hLqYKy8PG'))\n\n    @allure.feature(\"Управление проектами и билд конфигурациями\")\n    @allure.story(\n        \"Создание проекта и билд конфигурации с последующем для нее запуском под разными ролями\"\n    )\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.link(\"https://example.com/docs/create_project\", name=\"Документация\")\n    @allure.issue(\"https://issue.tracker/project/123\", name=\"Баг-трекер\")\n    @allure.testcase(\"https://testcase.manager/testcase/456\", name=\"Тест-кейс\")\n    @allure.title(\n        \"Проверка юзер флоу по созданию проекта, билд конфигурации и ее запуску\"\n    )\n    @allure.description(\n        \"Тест проверяет создание нового проекта и его появление в общем списке проектов.\"\n    )\n    def test_user_critical_flow_with_roles(\n        self,\n        super_admin,\n        user_create,\n        project_data,\n        build_conf_data,\n        build_conf_run_data,\n    ):\n    \n        with allure.step(\"Отправка запроса на создание проекта\"):\n            project_data_1 = project_data\n            create_project_response = (\n                super_admin.api_manager.project_api.create_project(\n                    project_data_1.model_dump()).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданного проекта с отправленными данными\"\n        ):\n            project_model_response = ProjectResponseModel.model_validate_json(\n                create_project_response\n            )\n        with pytest.assume:\n            assert (\n                project_model_response.id == project_data_1.id\n            ), f\"expected project id= {project_data_1.id}, but '{project_model_response.id}' given\"\n        with pytest.assume:\n            assert (\n                project_model_response.parentProjectId == project_data_1.parentProject[\"locator\"]\n            ), (\n                f\"expected parent project id= {project_data_1.parentProject['locator']},\"\n                f\" but '{project_model_response.parentProjectId}' given in response\"\n            )\n        with allure.step(\n            \"Проверка нахождения id созданного проекта в общем списке проектов\"\n        ):\n            get_project_response = (\n                super_admin.api_manager.project_api.get_project_by_locator(\n                    project_data_1.id).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданного проекта с отправленными данными\"\n        ):\n            created_model_project_response = ProjectResponseModel.model_validate_json(\n                get_project_response\n            )\n        with pytest.assume:\n            assert (\n                created_model_project_response.id == project_data_1.id\n            ), f\"There is no project with {project_data_1.id} id\"\n        with allure.step(\"Отправка запроса на создание билд конфигурации\"):\n            build_conf_data_1 = build_conf_data\n            build_config_response = (\n                super_admin.api_manager.build_conf_api.create_build_conf(\n                    build_conf_data_1.model_dump()).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"\n        ):\n            build_conf_model_response = BuildResponseModel.model_validate_json(\n                build_config_response\n            )\n        with pytest.assume:\n            assert build_conf_model_response.id == build_conf_data_1.id, (\n                f\"expected build conf id= {build_conf_data_1.id},\"\n                f\" but '{build_conf_model_response.id}' given\"\n            )\n        with allure.step(\n            \"Проверка нахождения id созданной билд конфигурации в общем списке билд конфигураций\"\n        ):\n            get_build_conf_response = (\n                super_admin.api_manager.build_conf_api.get_build_conf(\n                    build_conf_data_1.id).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"\n        ):\n            build_conf_model_response_1 = BuildResponseModel.model_validate_json(\n                get_build_conf_response\n            )\n        with pytest.assume:\n            assert build_conf_model_response_1.id == build_conf_data_1.id, (\n                f\"expected build conf id= {build_conf_data_1.id},\"\n                f\" but '{build_conf_model_response_1.id}' given\"\n            )\n        with allure.step(\"Отправка запроса на запуск созданной билд конфигурации\"):\n            build_conf_run_data_1 = build_conf_run_data\n            build_run_response = (\n                super_admin.api_manager.run_build_conf_api.run_build_conf(\n                    build_conf_run_data_1.model_dump()).text\n            )\n            time.sleep(20)\n        with allure.step(\n            \"Проверка соответствия параметров модели запуска билд конфига\"\n        ):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(\n                build_run_response\n            )\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", (\n                f\"build was expected to be run= {build_run_model_response.state} should be queued,\"\n                f\" but it is not in a query= {build_run_model_response.state}\"\n            )\n        with allure.step(\n            \"Отправка запроса на проверку количества билд конфигураций в очереди для запуска\"\n        ):\n            get_build_conf_run_response = (\n                super_admin.api_manager.build_conf_api.check_query_with_build_conf().text\n            )\n            time.sleep(15)\n        with allure.step(\n            \"Проверка соответствия параметров модели ответа запуска билд конфигурации с отправленными данными\"\n        ):\n            build_run_response = BuildConfRunStatusModel.model_validate_json(\n                get_build_conf_run_response\n            )\n        with pytest.assume:\n>           assert (\n                build_run_response.count == 0\n            ), f\"build was expected to be out of the query=0, but it is still here: query={build_run_response.count}\"\nE           pytest_assume.plugin.FailedAssumption: \nE           1 Failed Assumptions:\nE           \nE           tests/backend/test_user_critical_flow.py:140: AssumptionFailure\nE           >>\twith pytest.assume:\nE           AssertionError: build was expected to be out of the query=0, but it is still here: query=1\nE           assert 1 == 0\nE            +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 7, 'buildTypeId': 'J3hLqYKy8PG', 'state': 'queued', 'href': '/app/rest/buildQueue/id:7', 'webUrl': 'http://localhost:8111/build/7'}]).count\n\ntests/backend/test_user_critical_flow.py:141: FailedAssumption","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1712229722653,"stop":1712229722674,"duration":21},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_session","time":{"start":1712229880960,"stop":1712229880960,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"super_admin","time":{"start":1712229880961,"stop":1712229880965,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"project_data","time":{"start":1712229880965,"stop":1712229880965,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_run_data","time":{"start":1712229880965,"stop":1712229880966,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_create","time":{"start":1712229880965,"stop":1712229880965,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_data","time":{"start":1712229880965,"stop":1712229880965,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"testStage":{"description":"Тест проверяет создание нового проекта и его появление в общем списке проектов.","status":"failed","statusMessage":"pytest_assume.plugin.FailedAssumption: \n1 Failed Assumptions:\n\ntests/backend/test_user_critical_flow.py:140: AssumptionFailure\n>>\twith pytest.assume:\nAssertionError: build was expected to be out of the query=0, but it is still here: query=1\nassert 1 == 0\n +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 7, 'buildTypeId': 'J3hLqYKy8PG', 'state': 'queued', 'href': '/app/rest/buildQueue/id:7', 'webUrl': 'http://localhost:8111/build/7'}]).count","statusTrace":"self = <test_user_critical_flow.TestProjectCreate object at 0x7fa9a9a5f3a0>\nsuper_admin = <entities.user.User object at 0x7fa9a97e4be0>\nuser_create = <function user_create.<locals>._user_create at 0x7fa9a9738310>\nproject_data = ProjectDataModel(parentProject={'locator': '_Root'}, name='StAS78dH3D7', id='zpfj3Qzy47Q', copeAllAssociatedSettings=True)\nbuild_conf_data = BuildDataModel(id='J3hLqYKy8PG', name='wDXqbSHCcgI', project={'id': 'zpfj3Qzy47Q'}, steps={'step': [{'name': 'myComman...llo World!'\"}, {'name': 'teamcity.step.mode', 'value': 'default'}, {'name': 'use.custom.script', 'value': 'true'}]}}]})\nbuild_conf_run_data = BuildRunRequestModel(buildType=BuildTypesModel(id='J3hLqYKy8PG'))\n\n    @allure.feature(\"Управление проектами и билд конфигурациями\")\n    @allure.story(\n        \"Создание проекта и билд конфигурации с последующем для нее запуском под разными ролями\"\n    )\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.link(\"https://example.com/docs/create_project\", name=\"Документация\")\n    @allure.issue(\"https://issue.tracker/project/123\", name=\"Баг-трекер\")\n    @allure.testcase(\"https://testcase.manager/testcase/456\", name=\"Тест-кейс\")\n    @allure.title(\n        \"Проверка юзер флоу по созданию проекта, билд конфигурации и ее запуску\"\n    )\n    @allure.description(\n        \"Тест проверяет создание нового проекта и его появление в общем списке проектов.\"\n    )\n    def test_user_critical_flow_with_roles(\n        self,\n        super_admin,\n        user_create,\n        project_data,\n        build_conf_data,\n        build_conf_run_data,\n    ):\n    \n        with allure.step(\"Отправка запроса на создание проекта\"):\n            project_data_1 = project_data\n            create_project_response = (\n                super_admin.api_manager.project_api.create_project(\n                    project_data_1.model_dump()).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданного проекта с отправленными данными\"\n        ):\n            project_model_response = ProjectResponseModel.model_validate_json(\n                create_project_response\n            )\n        with pytest.assume:\n            assert (\n                project_model_response.id == project_data_1.id\n            ), f\"expected project id= {project_data_1.id}, but '{project_model_response.id}' given\"\n        with pytest.assume:\n            assert (\n                project_model_response.parentProjectId == project_data_1.parentProject[\"locator\"]\n            ), (\n                f\"expected parent project id= {project_data_1.parentProject['locator']},\"\n                f\" but '{project_model_response.parentProjectId}' given in response\"\n            )\n        with allure.step(\n            \"Проверка нахождения id созданного проекта в общем списке проектов\"\n        ):\n            get_project_response = (\n                super_admin.api_manager.project_api.get_project_by_locator(\n                    project_data_1.id).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданного проекта с отправленными данными\"\n        ):\n            created_model_project_response = ProjectResponseModel.model_validate_json(\n                get_project_response\n            )\n        with pytest.assume:\n            assert (\n                created_model_project_response.id == project_data_1.id\n            ), f\"There is no project with {project_data_1.id} id\"\n        with allure.step(\"Отправка запроса на создание билд конфигурации\"):\n            build_conf_data_1 = build_conf_data\n            build_config_response = (\n                super_admin.api_manager.build_conf_api.create_build_conf(\n                    build_conf_data_1.model_dump()).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"\n        ):\n            build_conf_model_response = BuildResponseModel.model_validate_json(\n                build_config_response\n            )\n        with pytest.assume:\n            assert build_conf_model_response.id == build_conf_data_1.id, (\n                f\"expected build conf id= {build_conf_data_1.id},\"\n                f\" but '{build_conf_model_response.id}' given\"\n            )\n        with allure.step(\n            \"Проверка нахождения id созданной билд конфигурации в общем списке билд конфигураций\"\n        ):\n            get_build_conf_response = (\n                super_admin.api_manager.build_conf_api.get_build_conf(\n                    build_conf_data_1.id).text\n            )\n        with allure.step(\n            \"Проверка соответствия параметров созданной билд конфигурации с отправленными данными\"\n        ):\n            build_conf_model_response_1 = BuildResponseModel.model_validate_json(\n                get_build_conf_response\n            )\n        with pytest.assume:\n            assert build_conf_model_response_1.id == build_conf_data_1.id, (\n                f\"expected build conf id= {build_conf_data_1.id},\"\n                f\" but '{build_conf_model_response_1.id}' given\"\n            )\n        with allure.step(\"Отправка запроса на запуск созданной билд конфигурации\"):\n            build_conf_run_data_1 = build_conf_run_data\n            build_run_response = (\n                super_admin.api_manager.run_build_conf_api.run_build_conf(\n                    build_conf_run_data_1.model_dump()).text\n            )\n            time.sleep(20)\n        with allure.step(\n            \"Проверка соответствия параметров модели запуска билд конфига\"\n        ):\n            build_run_model_response = BuildRunResponseModel.model_validate_json(\n                build_run_response\n            )\n        with pytest.assume:\n            assert build_run_model_response.state == \"queued\", (\n                f\"build was expected to be run= {build_run_model_response.state} should be queued,\"\n                f\" but it is not in a query= {build_run_model_response.state}\"\n            )\n        with allure.step(\n            \"Отправка запроса на проверку количества билд конфигураций в очереди для запуска\"\n        ):\n            get_build_conf_run_response = (\n                super_admin.api_manager.build_conf_api.check_query_with_build_conf().text\n            )\n            time.sleep(15)\n        with allure.step(\n            \"Проверка соответствия параметров модели ответа запуска билд конфигурации с отправленными данными\"\n        ):\n            build_run_response = BuildConfRunStatusModel.model_validate_json(\n                get_build_conf_run_response\n            )\n        with pytest.assume:\n>           assert (\n                build_run_response.count == 0\n            ), f\"build was expected to be out of the query=0, but it is still here: query={build_run_response.count}\"\nE           pytest_assume.plugin.FailedAssumption: \nE           1 Failed Assumptions:\nE           \nE           tests/backend/test_user_critical_flow.py:140: AssumptionFailure\nE           >>\twith pytest.assume:\nE           AssertionError: build was expected to be out of the query=0, but it is still here: query=1\nE           assert 1 == 0\nE            +  where 1 = BuildConfRunStatusModel(count=1, href='/app/rest/buildQueue', build=[{'id': 7, 'buildTypeId': 'J3hLqYKy8PG', 'state': 'queued', 'href': '/app/rest/buildQueue/id:7', 'webUrl': 'http://localhost:8111/build/7'}]).count\n\ntests/backend/test_user_critical_flow.py:141: FailedAssumption","steps":[{"name":"Отправка запроса на создание проекта","time":{"start":1712229880966,"stop":1712229880977,"duration":11},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданного проекта с отправленными данными","time":{"start":1712229880977,"stop":1712229880978,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка нахождения id созданного проекта в общем списке проектов","time":{"start":1712229880980,"stop":1712229880987,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданного проекта с отправленными данными","time":{"start":1712229880987,"stop":1712229880987,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на создание билд конфигурации","time":{"start":1712229880988,"stop":1712229880999,"duration":11},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданной билд конфигурации с отправленными данными","time":{"start":1712229880999,"stop":1712229880999,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка нахождения id созданной билд конфигурации в общем списке билд конфигураций","time":{"start":1712229881001,"stop":1712229881005,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров созданной билд конфигурации с отправленными данными","time":{"start":1712229881005,"stop":1712229881005,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на запуск созданной билд конфигурации","time":{"start":1712229881007,"stop":1712229901037,"duration":20030},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров модели запуска билд конфига","time":{"start":1712229901037,"stop":1712229901037,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Отправка запроса на проверку количества билд конфигураций в очереди для запуска","time":{"start":1712229901038,"stop":1712229916057,"duration":15019},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"Проверка соответствия параметров модели ответа запуска билд конфигурации с отправленными данными","time":{"start":1712229916057,"stop":1712229916057,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"attachments":[{"uid":"77e6ccc6e2bcdeaf","name":"log","source":"77e6ccc6e2bcdeaf.txt","type":"text/plain","size":7180}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":12,"attachmentsCount":1,"hasContent":true},"afterStages":[{"name":"build_conf_run_data::0","time":{"start":1712229916066,"stop":1712229916066,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"build_conf_data::0","time":{"start":1712229916066,"stop":1712229916089,"duration":23},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"project_data::0","time":{"start":1712229916090,"stop":1712229916109,"duration":19},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_create::0","time":{"start":1712229916110,"stop":1712229916110,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"user_session::0","time":{"start":1712229916112,"stop":1712229916112,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"labels":[{"name":"feature","value":"Управление проектами и билд конфигурациями"},{"name":"severity","value":"critical"},{"name":"story","value":"Создание проекта и билд конфигурации с последующем для нее запуском под разными ролями"},{"name":"parentSuite","value":"tests.backend"},{"name":"suite","value":"test_user_critical_flow"},{"name":"subSuite","value":"TestProjectCreate"},{"name":"host","value":"fv-az738-309"},{"name":"thread","value":"7931-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.backend.test_user_critical_flow"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"build_conf_data","value":"'wDXqbSHCcgI'"},{"name":"project_data","value":"'StAS78dH3D7'"},{"name":"user_create","value":"<Roles.PROJECT_ADMIN: 'PROJECT_ADMIN'>"}],"links":[{"name":"Тест-кейс","url":"https://testcase.manager/testcase/456","type":"tms"},{"name":"Баг-трекер","url":"https://issue.tracker/project/123","type":"issue"},{"name":"Документация","url":"https://example.com/docs/create_project","type":"link"}],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"d7f07fdbbb6ef53b.json","parameterValues":["'wDXqbSHCcgI'","'StAS78dH3D7'","<Roles.PROJECT_ADMIN: 'PROJECT_ADMIN'>"]}